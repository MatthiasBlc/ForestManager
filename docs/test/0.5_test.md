Voici un guide de test complet pour la phase 0.5 :

1. Créer un SuperAdmin (CLI)  


# Dans le container backend

docker exec -it forestmanager-backend npm run admin:create

Tu devras entrer : username, email, password. Note bien ces  
 infos.

2. Tester le login admin (Frontend)  


URL : http://localhost:3000/admin/login

Flow attendu :

1. Entre email + password → bouton "Continue"
2. Première connexion : QR code affiché → scanne avec Google  
   Authenticator / Authy
3. Entre le code TOTP 6 chiffres → "Verify"
4. Redirection vers /admin/dashboard  

5. Tester le dashboard admin  


URL : http://localhost:3000/admin/dashboard

Devrait afficher :

- Stats globales (users, communities, recipes, tags,  
  ingredients, features)
- Stats des 7 derniers jours
- Top 5 communautés  


4. Tester les API admin (curl)  


# D'abord, login pour obtenir le cookie de session

# Etape 1: credentials

curl -X POST http://localhost:3001/api/admin/auth/login \  
 -H "Content-Type: application/json" \  
 -d '{"email":"ton@email.com","password":"tonpassword"}' \  
 -c cookies.txt -v

# Etape 2: TOTP (remplace CODE par le code de ton app)

curl -X POST http://localhost:3001/api/admin/auth/totp/verify
\  
 -H "Content-Type: application/json" \  
 -d '{"code":"123456"}' \  
 -b cookies.txt -c cookies.txt

# Tester /me

curl http://localhost:3001/api/admin/auth/me -b cookies.txt

# Dashboard stats

curl http://localhost:3001/api/admin/dashboard/stats -b  
 cookies.txt

# Liste des tags

curl http://localhost:3001/api/admin/tags -b cookies.txt

# Liste des ingredients

curl http://localhost:3001/api/admin/ingredients -b  
 cookies.txt

# Liste des features

curl http://localhost:3001/api/admin/features -b cookies.txt

# Liste des communautés

curl http://localhost:3001/api/admin/communities -b  
 cookies.txt

# Activité admin

curl http://localhost:3001/api/admin/activity -b cookies.txt

5. Tester la sécurité  


# Vérifier les headers helmet

curl -sI http://localhost:3001/health | grep -E  
 "(Content-Security|X-Frame|X-Content-Type)"

# Tester le rate limiting auth (5 tentatives max en 15min)

for i in {1..6}; do  
 echo "Tentative $i:"  
 curl -s -X POST http://localhost:3001/api/admin/auth/login \
 -H "Content-Type: application/json" \  
 -d '{"email":"fake@test.com","password":"wrong"}' | head  
 -c 100  
 echo  
 done

# La 6ème devrait retourner ADMIN_010: Too many login attempts

# Tester rate limiting global admin (30 req/min)

for i in {1..35}; do  
 curl -s http://localhost:3001/api/admin/tags -b cookies.txt
-o /dev/null -w "%{http_code} "  
 done

# Après 30 requêtes → 429

6. Tester les CRUD admin  


# Créer un tag

curl -X POST http://localhost:3001/api/admin/tags \  
 -H "Content-Type: application/json" \  
 -d '{"name":"Dessert"}' \  
 -b cookies.txt

# Créer un ingrédient

curl -X POST http://localhost:3001/api/admin/ingredients \  
 -H "Content-Type: application/json" \  
 -d '{"name":"Farine"}' \  
 -b cookies.txt

# Créer une feature

curl -X POST http://localhost:3001/api/admin/features \  
 -H "Content-Type: application/json" \  
 -d '{"code":"PREMIUM","name":"Premium  
 Features","description":"Fonctionnalites premium"}' \  
 -b cookies.txt

7. Vérifier la DB (Prisma Studio)  


URL : http://localhost:5555

Tables à vérifier :

- AdminUser : ton admin créé
- AdminSession : session active
- AdminActivityLog : logs des actions (ADMIN_LOGIN,  
  ADMIN_TOTP_SETUP, etc.)
- Feature : feature MVP (isDefault: true)
- Tag, Ingredient : tes créations  


8. Tester le logout  


curl -X POST http://localhost:3001/api/admin/auth/logout -b  
 cookies.txt

# Vérifier que la session est détruite

curl http://localhost:3001/api/admin/auth/me -b cookies.txt

# Devrait retourner 401

Checklist rapide  
 Test: Créer admin  
 Commande/URL: docker exec -it forestmanager-backend npm run  
 admin:create  
 ────────────────────────────────────────  
 Test: Login frontend  
 Commande/URL: http://localhost:3000/admin/login  
 ────────────────────────────────────────  
 Test: Dashboard  
 Commande/URL: http://localhost:3000/admin/dashboard  
 ────────────────────────────────────────  
 Test: Prisma Studio  
 Commande/URL: http://localhost:5555  
 ────────────────────────────────────────  
 Test: Headers sécurité  
 Commande/URL: curl -sI http://localhost:3001/health  
 ────────────────────────────────────────  
 Test: Rate limit  
 Commande/URL: 6 tentatives login = bloqué
